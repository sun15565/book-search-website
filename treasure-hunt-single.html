<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vueå¯»å®æ¸¸æˆ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.js"></script>
    <script src="https://unpkg.com/vue-demi@0.14.6/lib/index.iife.js"></script>
    <script src="https://unpkg.com/pinia@2/dist/pinia.iife.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #app {
            min-height: 100vh;
        }

        button {
            cursor: pointer;
            border: none;
            outline: none;
            font-family: inherit;
        }

        input, textarea {
            font-family: inherit;
            outline: none;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.8);
        }

        .app-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #fff9e6 0%, #fff5d6 100%);
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .logo {
            font-size: 2rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-link {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: #ffc107;
            color: #333;
        }

        .nav-link.router-link-active {
            background: #ffc107;
            color: #333;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-left: 1rem;
            padding-left: 1rem;
            border-left: 1px solid #e0e0e0;
        }

        .user-name {
            color: #333;
            font-weight: 600;
        }

        .logout-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s ease;
        }

        .logout-btn:hover {
            background: #d32f2f;
        }

        .main-content {
            padding: 2rem;
        }

        /* æ¸¸æˆå¸ƒå±€ */
        .game-view {
            min-height: calc(100vh - 100px);
            padding: 1rem;
        }

        .game-layout {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 1.5rem;
            max-width: 1800px;
            margin: 0 auto;
        }

        .left-panel,
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .game-area {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(255, 193, 7, 0.2);
            border: 2px solid #ffc107;
        }

        /* è®¤è¯é¡µé¢ */
        .auth-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #fff9e6 0%, #fff5d6 100%);
            padding: 2rem;
        }

        .auth-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(255, 193, 7, 0.3);
            border: 2px solid #ffc107;
            width: 500px;
            min-width: 500px;
            overflow: hidden;
        }

        .auth-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-btn {
            flex: 1;
            padding: 1rem;
            border: none;
            background:            transparent;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: #ffc107;
            color: #333;
        }

        .tab-btn:hover:not(.active) {
            background: #e9ecef;
            color: #333;
        }

        .auth-content {
            padding: 2rem;
        }

        /* è¡¨å•æ ·å¼ */
        .form-container {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 60px rgba(255, 193, 7, 0.3);
            border: 2px solid #ffc107;
            width: 400px;
            min-width: 400px;
        }

        .form-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .form-header h2 {
            color: #f57c00;
            font-size: 2rem;
            margin: 0 0 0.5rem 0;
        }

        .form-header p {
            color: #666;
            margin: 0;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .form-input:focus {
            outline: none;
            border-color: #ffc107;
            box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.1);
        }

        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
            color: #333;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .form-footer {
            text-align: center;
        }

        .form-footer a {
            color: #ffc107;
            text-decoration: none;
            font-weight: 600;
        }

        .form-footer a:hover {
            text-decoration: underline;
        }

        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .avatar-option {
            font-size: 2rem;
            padding: 1rem;
            text-align: center;
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .avatar-option:hover {
            background: #e9ecef;
            transform: scale(1.1);
        }

        .avatar-option.active {
            border-color: #ffc107;
            background: #fff9e6;
        }

        /* ç©å®¶ä¿¡æ¯æ ·å¼ */
        .player-info {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(255, 193, 7, 0.2);
            border: 2px solid #ffc107;
            margin-bottom: 1rem;
        }

        .player-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .avatar {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .player-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }

        .player-stats {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        .stat-value {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
        }

        /* å•†åº—æ ·å¼ */
        .shop {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            border: 2px solid #ffc107;
            max-height: 500px;
            overflow-y: auto;
        }

        .shop-header {
            margin-bottom: 1rem;
        }

        .shop-header h3 {
            color: #f57c00;
            font-size: 1.2rem;
            margin: 0;
        }

        .shop-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .shop-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .shop-item:hover {
            border-color: #ffc107;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.3);
        }

        .item-icon {
            font-size: 2.5rem;
            flex-shrink: 0;
        }

        .item-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .item-name {
            font-size: 1rem;
            color: #333;
            margin: 0;
        }

        .item-effect {
            font-size: 0.85rem;
            color: #666;
            margin: 0;
        }

        .item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
        }

        .item-price {
            font-size: 1rem;
            color: #f57c00;
            font-weight: 600;
        }

        .buy-btn {
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
            color: #333;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .buy-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(255, 193, 7, 0.5);
        }

        .buy-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1400px) {
            .game-layout {
                grid-template-columns: 250px 1fr 250px;
            }
        }

        @media (max-width: 1200px) {
            .game-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }
            
            .left-panel,
            .right-panel {
                flex-direction: row;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;
        const { createRouter, createWebHistory } = VueRouter;
        const { createPinia, defineStore } = Pinia;

        // è®¤è¯çŠ¶æ€ç®¡ç†
        const useAuthStore = defineStore('auth', () => {
            const currentUser = ref(null);
            const users = ref(loadUsersFromStorage());
            const userGameData = ref(loadUserGameDataFromStorage());

            const isLoggedIn = computed(() => !!currentUser.value);
            const currentUserData = computed(() => {
                if (!currentUser.value) return null;
                return userGameData.value[currentUser.value.username] || null;
            });

            function loadUsersFromStorage() {
                try {
                    const data = localStorage.getItem('treasure-hunt-users');
                    if (data) {
                        return JSON.parse(data);
                    } else {
                        const demoUsers = {
                            'demo1': {
                                username: 'demo1',
                                password: '123456',
                                avatar: 'ğŸ§™',
                                createdAt: new Date().toISOString()
                            },
                            'demo2': {
                                username: 'demo2',
                                password: '123456',
                                avatar: 'ğŸ¦¸',
                                createdAt: new Date().toISOString()
                            }
                        };
                        localStorage.setItem('treasure-hunt-users', JSON.stringify(demoUsers));
                        return demoUsers;
                    }
                } catch (error) {
                    console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
                    return {};
                }
            }

            function loadUserGameDataFromStorage() {
                try {
                    const data = localStorage.getItem('treasure-hunt-user-game-data');
                    if (data) {
                        return JSON.parse(data);
                    } else {
                        const demoGameData = {
                            'demo1': {
                                player: {
                                    id: 1,
                                    name: 'demo1',
                                    level: 8,
                                    exp: 150,
                                    coins: 5000,
                                    gems: 120,
                                    avatar: 'ğŸ§™',
                                    health: 100,
                                    maxHealth: 100
                                },
                                mapData: [
                                    { id: 1, x: 50, y: 50, type: 'treasure', status: 'opened', level: 1 },
                                    { id: 2, x: 150, y: 100, type: 'treasure', status: 'opened', level: 2 },
                                    { id: 3, x: 250, y: 150, type: 'treasure', status: 'locked', level: 3 },
                                    { id: 4, x: 350, y: 200, type: 'treasure', status: 'locked', level: 4 },
                                    { id: 5, x: 450, y: 250, type: 'treasure', status: 'locked', level: 5 },
                                    { id: 6, x: 100, y: 200, type: 'shop', status: 'available' },
                                    { id: 7, x: 300, y: 100, type: 'task', status: 'available' }
                                ],
                                tasks: [
                                    { id: 1, title: 'å¼€å¯ç¬¬ä¸€ä¸ªå®ç®±', description: 'åœ¨åœ°å›¾ä¸Šæ‰¾åˆ°å¹¶å¼€å¯ç¬¬ä¸€ä¸ªå®ç®±', reward: { coins: 100, exp: 50 }, completed: true },
                                    { id: 2, title: 'æ”¶é›†é‡‘å¸', description: 'æ”¶é›†500é‡‘å¸', reward: { coins: 200, exp: 100 }, completed: true, progress: 500, target: 500 },
                                    { id: 3, title: 'è¾¾åˆ°5çº§', description: 'å°†ç­‰çº§æå‡åˆ°5çº§', reward: { coins: 300, gems: 10 }, completed: true, progress: 8, target: 5 }
                                ],
                                shopItems: [
                                    { id: 1, name: 'ç”Ÿå‘½è¯æ°´', price: 50, type: 'potion', effect: 'æ¢å¤50ç”Ÿå‘½å€¼' },
                                    { id: 2, name: 'ç»éªŒåŠ æˆ', price: 100, type: 'boost', effect: 'ç»éªŒè·å–+50%' },
                                    { id: 3, name: 'é‡‘å¸åŠ æˆ', price: 150, type: 'boost', effect: 'é‡‘å¸è·å–+50%' },
                                    { id: 4, name: 'ä¼ å¥‡è£…å¤‡', price: 500, type: 'equipment', effect: 'å…¨å±æ€§+10' }
                                ],
                                inventory: [
                                    { id: 1, name: 'ç”Ÿå‘½è¯æ°´', price: 50, type: 'potion', effect: 'æ¢å¤50ç”Ÿå‘½å€¼', purchaseDate: new Date() }
                                ],
                                rankings: []
                            }
                        };
                        localStorage.setItem('treasure-hunt-user-game-data', JSON.stringify(demoGameData));
                        return demoGameData;
                    }
                } catch (error) {
                    console.error('åŠ è½½ç”¨æˆ·æ¸¸æˆæ•°æ®å¤±è´¥:', error);
                    return {};
                }
            }

            async function register(username, password, avatar) {
                if (users.value[username]) {
                    return false;
                }

                users.value[username] = {
                    username,
                    password,
                    avatar,
                    createdAt: new Date().toISOString()
                };

                userGameData.value[username] = {
                    player: {
                        id: Date.now(),
                        name: username,
                        level: 1,
                        exp: 0,
                        coins: 1000,
                        gems: 50,
                        avatar: avatar,
                        health: 100,
                        maxHealth: 100
                    },
                    mapData: [
                        { id: 1, x: 50, y: 50, type: 'treasure', status: 'locked', level: 1 },
                        { id: 2, x: 150, y: 100, type: 'treasure', status: 'locked', level: 2 },
                        { id: 3, x: 250, y: 150, type: 'treasure', status: 'locked', level: 3 },
                        { id: 4, x: 350, y: 200, type: 'treasure', status: 'locked', level: 4 },
                        { id: 5, x: 450, y: 250, type: 'treasure', status: 'locked', level: 5 },
                        { id: 6, x: 100, y: 200, type: 'shop', status: 'available' },
                        { id: 7, x: 300, y: 100, type: 'task', status: 'available' }
                    ],
                    tasks: [
                        { id: 1, title: 'å¼€å¯ç¬¬ä¸€ä¸ªå®ç®±', description: 'åœ¨åœ°å›¾ä¸Šæ‰¾åˆ°å¹¶å¼€å¯ç¬¬ä¸€ä¸ªå®ç®±', reward: { coins: 100, exp: 50 }, completed: false },
                        { id: 2, title: 'æ”¶é›†é‡‘å¸', description: 'æ”¶é›†500é‡‘å¸', reward: { coins: 200, exp: 100 }, completed: false, progress: 0, target: 500 },
                        { id: 3, title: 'è¾¾åˆ°5çº§', description: 'å°†ç­‰çº§æå‡åˆ°5çº§', reward: { coins: 300, gems: 10 }, completed: false, progress: 1, target: 5 }
                    ],
                    shopItems: [
                        { id: 1, name: 'ç”Ÿå‘½è¯æ°´', price: 50, type: 'potion', effect: 'æ¢å¤50ç”Ÿå‘½å€¼' },
                        { id: 2, name: 'ç»éªŒåŠ æˆ', price: 100, type: 'boost', effect: 'ç»éªŒè·å–+50%' },
                        { id: 3, name: 'é‡‘å¸åŠ æˆ', price: 150, type: 'boost', effect: 'é‡‘å¸è·å–+50%' },
                        { id: 4, name: 'ä¼ å¥‡è£…å¤‡', price: 500, type: 'equipment', effect: 'å…¨å±æ€§+10' }
                    ],
                    inventory: [],
                    rankings: []
                };

                localStorage.setItem('treasure-hunt-users', JSON.stringify(users.value));
                localStorage.setItem('treasure-hunt-user-game-data', JSON.stringify(userGameData.value));

                return true;
            }

            async function login(username, password) {
                const user = users.value[username];
                if (user && user.password === password) {
                    currentUser.value = user;
                    localStorage.setItem('treasure-hunt-current-user', JSON.stringify(user));
                    return true;
                }
                return false;
            }

            function logout() {
                currentUser.value = null;
                localStorage.removeItem('treasure-hunt-current-user');
            }

            function checkLoggedInUser() {
                try {
                    const userData = localStorage.getItem('treasure-hunt-current-user');
                    if (userData) {
                        currentUser.value = JSON.parse(userData);
                    }
                } catch (error) {
                    console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:', error);
                }
            }

            function updateUserGameData(gameData) {
                if (currentUser.value) {
                    userGameData.value[currentUser.value.username] = gameData;
                    localStorage.setItem('treasure-hunt-user-game-data', JSON.stringify(userGameData.value));
                }
            }

            function getAllUsersRankings() {
                const rankings = [];
                for (const [username, data] of Object.entries(userGameData.value)) {
                    if (data && data.player) {
                        rankings.push({
                            id: data.player.id,
                            name: username,
                            level: data.player.level,
                            coins: data.player.coins,
                            gems: data.player.gems,
                            avatar: data.player.avatar
                        });
                    }
                }
                return rankings.sort((a, b) => {
                    if (b.level !== a.level) return b.level - a.level;
                    return b.coins - a.coins;
                });
            }

            return {
                currentUser,
                users,
                userGameData,
                isLoggedIn,
                currentUserData,
                register,
                login,
                logout,
                checkLoggedInUser,
                updateUserGameData,
                getAllUsersRankings
            };
        });

        // æ¸¸æˆçŠ¶æ€ç®¡ç†
        const useGameStore = defineStore('game', () => {
            const authStore = useAuthStore();
            
            const getCurrentUserData = () => {
                if (!authStore.isLoggedIn || !authStore.currentUserData) {
                    return null;
                }
                return authStore.currentUserData;
            };

            const player = computed(() => {
                const userData = getCurrentUserData();
                return userData ? userData.player : null;
            });

            const mapData = computed(() => {
                const userData = getCurrentUserData();
                return userData ? userData.mapData : [];
            });

            const tasks = computed(() => {
                const userData = getCurrentUserData();
                return userData ? userData.tasks : [];
            });

            const shopItems = computed(() => {
                const userData = getCurrentUserData();
                return userData ? userData.shopItems : [];
            });

            const inventory = computed(() => {
                const userData = getCurrentUserData();
                return userData ? userData.inventory : [];
            });

            const rankings = computed(() => {
                return authStore.getAllUsersRankings();
            });

            function saveCurrentUserData() {
                const userData = getCurrentUserData();
                if (userData && authStore.isLoggedIn) {
                    authStore.updateUserGameData(userData);
                }
            }

            function openTreasure(treasureId) {
                const userData = getCurrentUserData();
                if (!userData) return null;
                
                const treasure = userData.mapData.find(t => t.id === treasureId);
                if (treasure && treasure.status === 'locked') {
                    treasure.status = 'opened';
                    const reward = {
                        coins: treasure.level * 100,
                        exp: treasure.level * 50,
                        gems: treasure.level * 5
                    };
                    userData.player.coins += reward.coins;
                    userData.player.exp += reward.exp;
                    userData.player.gems += reward.gems;
                    
                    checkLevelUp();
                    saveCurrentUserData();
                    
                    return reward;
                }
                return null;
            }

            function checkLevelUp() {
                const userData = getCurrentUserData();
                if (!userData) return;
                
                const expNeeded = userData.player.level * 100;
                if (userData.player.exp >= expNeeded) {
                    userData.player.level++;
                    userData.player.exp -= expNeeded;
                    userData.player.maxHealth += 20;
                    userData.player.health = userData.player.maxHealth;
                    
                    updateTaskProgress(3, userData.player.level);
                    saveCurrentUserData();
                    
                    checkLevelUp();
                }
            }

            function buyItem(itemId) {
                const userData = getCurrentUserData();
                if (!userData) return false;
                
                const item = userData.shopItems.find(i => i.id === itemId);
                if (item && userData.player.coins >= item.price) {
                    userData.player.coins -= item.price;
                    userData.inventory.push({ ...item, purchaseDate: new Date() });
                    
                    saveCurrentUserData();
                    return true;
                }
                return false;
            }

            function updateTaskProgress(taskId, progress) {
                const userData = getCurrentUserData();
                if (!userData) return;
                
                const task = userData.tasks.find(t => t.id === taskId);
                if (task && !task.completed) {
                    task.progress = progress;
                    if (task.progress >= task.target) {
                        completeTask(taskId);
                    }
                    saveCurrentUserData();
                }
            }

            function completeTask(taskId) {
                const userData = getCurrentUserData();
                if (!userData) return;
                
                const task = userData.tasks.find(t => t.id === taskId);
                if (task && !task.completed) {
                    task.completed = true;
                    userData.player.coins += task.reward.coins || 0;
                    userData.player.exp += task.reward.exp || 0;
                    userData.player.gems += task.reward.gems || 0;
                    checkLevelUp();
                    saveCurrentUserData();
                }
            }

            return {
                player,
                mapData,
                tasks,
                shopItems,
                inventory,
                rankings,
                openTreasure,
                buyItem,
                completeTask,
                updateTaskProgress,
                getCurrentUserData,
                saveCurrentUserData
            };
        });

        // ä¸»åº”ç”¨ç»„ä»¶
        const App = {
            setup() {
                const authStore = useAuthStore();

                onMounted(() => {
                    authStore.checkLoggedInUser();
                });

                function handleLogout() {
                    if (confirm('ç¡®å®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                        authStore.logout();
                    }
                }

                return {
                    authStore,
                    handleLogout
                };
            },
            template: `
                <div class="app-container">
                    <nav class="navbar">
                        <div class="nav-brand">
                            <span class="logo">ğŸ—ºï¸</span>
                            <span class="brand-name">å¯»å®æ¸¸æˆ</span>
                        </div>
                        <div class="nav-links">
                            <template v-if="authStore.isLoggedIn">
                                <router-link to="/" class="nav-link">æ¸¸æˆ</router-link>
                                <div class="user-info">
                                    <span class="user-name">{{ authStore.currentUser?.username }}</span>
                                    <button @click="handleLogout" class="logout-btn">ç™»å‡º</button>
                                </div>
                            </template>
                            <template v-else>
                                <router-link to="/auth" class="nav-link">ç™»å½•/æ³¨å†Œ</router-link>
                            </template>
                        </div>
                    </nav>
                    <main class="main-content">
                        <router-view />
                    </main>
                </div>
            `
        };

        // è®¤è¯é¡µé¢ç»„ä»¶
        const Auth = {
            setup() {
                const activeTab = ref('login');

                return {
                    activeTab
                };
            },
            template: `
                <div class="auth-page">
                    <div class="auth-container">
                        <div class="auth-tabs">
                            <button 
                                @click="activeTab = 'login'"
                                :class="{ active: activeTab === 'login' }"
                                class="tab-btn"
                            >
                                ç™»å½•
                            </button>
                            <button 
                                @click="activeTab = 'register'"
                                :class="{ active: activeTab === 'register' }"
                                class="tab-btn"
                            >
                                æ³¨å†Œ
                            </button>
                        </div>
                        
                        <div class="auth-content">
                            <LoginForm v-if="activeTab === 'login'" @switch-to-register="activeTab = 'register'" />
                            <RegisterForm v-else @switch-to-login="activeTab = 'login'" />
                        </div>
                    </div>
                </div>
            `
        };

        // ç™»å½•è¡¨å•ç»„ä»¶
        const LoginForm = {
            emits: ['switch-to-register'],
            setup(props, { emit }) {
                const authStore = useAuthStore();
                const isLoading = ref(false);

                const loginForm = ref({
                    username: '',
                    password: ''
                });

                async function handleLogin() {
                    isLoading.value = true;
                    try {
                        const success = await authStore.login(loginForm.value.username, loginForm.value.password);
                        if (success) {
                            window.location.href = '/';
                        } else {
                            alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼');
                        }
                    } catch (error) {
                        alert('ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                    } finally {
                        isLoading.value = false;
                    }
                }

                return {
                    authStore,
                    isLoading,
                    loginForm,
                    handleLogin
                };
            },
            template: `
                <div class="form-container">
                    <div class="form-header">
                        <h2>ğŸ® ç™»å½•æ¸¸æˆ</h2>
                        <p>æ¬¢è¿å›åˆ°å¯»å®ä¸–ç•Œï¼</p>
                    </div>
                    
                    <form @submit.prevent="handleLogin" class="form">
                        <div class="form-group">
                            <label for="username">ç”¨æˆ·å</label>
                            <input
                                id="username"
                                v-model="loginForm.username"
                                type="text"
                                placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
                                class="form-input"
                                required
                            />
                        </div>
                        
                        <div class="form-group">
                            <label for="password">å¯†ç </label>
                            <input
                                id="password"
                                v-model="loginForm.password"
                                type="password"
                                placeholder="è¯·è¾“å…¥å¯†ç "
                                class="form-input"
                                required
                            />
                        </div>
                        
                        <button type="submit" class="btn btn-primary" :disabled="isLoading">
                            {{ isLoading ? 'ç™»å½•ä¸­...' : 'ç™»å½•' }}
                        </button>
                        
                        <div class="form-footer">
                            <p>è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<a href="#" @click="$emit('switch-to-register')">ç«‹å³æ³¨å†Œ</a></p>
                        </div>
                    </form>
                </div>
            `
        };

        // æ³¨å†Œè¡¨å•ç»„ä»¶
        const RegisterForm = {
            emits: ['switch-to-login'],
            setup(props, { emit }) {
                const authStore = useAuthStore();
                const isLoading = ref(false);

                const registerForm = ref({
                    username: '',
                    password: '',
                    confirmPassword: '',
                    avatar: 'ğŸ‘¤'
                });

                const avatars = ['ğŸ‘¤', 'ğŸ§™', 'ğŸ¦¸', 'ğŸ§', 'ğŸ¦¹', 'ğŸ§š', 'ğŸ‘¨â€ğŸš€', 'ğŸ‘©â€ğŸ”¬', 'âš”ï¸', 'ğŸ›¡ï¸', 'ğŸ¹', 'ğŸ­'];

                const isFormValid = computed(() => {
                    return registerForm.value.username.length >= 3 &&
                           registerForm.value.password.length >= 6 &&
                           registerForm.value.password === registerForm.value.confirmPassword;
                });

                async function handleRegister() {
                    if (!isFormValid.value) {
                        alert('è¯·æ£€æŸ¥è¾“å…¥ä¿¡æ¯ï¼');
                        return;
                    }
                    
                    isLoading.value = true;
                    try {
                        const success = await authStore.register(
                            registerForm.value.username,
                            registerForm.value.password,
                            registerForm.value.avatar
                        );
                        if (success) {
                            alert('æ³¨å†ŒæˆåŠŸï¼æ­£åœ¨ä¸ºæ‚¨ç™»å½•...');
                            await authStore.login(registerForm.value.username, registerForm.value.password);
                            window.location.href = '/';
                        } else {
                            alert('ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·é€‰æ‹©å…¶ä»–ç”¨æˆ·åï¼');
                        }
                    } catch (error) {
                        alert('æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                    } finally {
                        isLoading.value = false;
                    }
                }

                return {
                    authStore,
                    isLoading,
                    registerForm,
                    avatars,
                    isFormValid,
                    handleRegister
                };
            },
            template: `
                <div class="form-container">
                    <div class="form-header">
                        <h2>ğŸ¯ æ³¨å†Œè´¦å·</h2>
                        <p>å¼€å§‹æ‚¨çš„å¯»å®å†’é™©ä¹‹æ—…ï¼</p>
                    </div>
                    
                    <form @submit.prevent="handleRegister" class="form">
                        <div class="form-group">
                            <label for="username">ç”¨æˆ·å</label>
                            <input
                                id="username"
                                v-model="registerForm.username"
                                type="text"
                                placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
                                class="form-input"
                                required
                                minlength="3"
                                maxlength="20"
                            />
                        </div>
                        
                        <div class="form-group">
                            <label for="password">å¯†ç </label>
                            <input
                                id="password"
                                v-model="registerForm.password"
                                type="password"
                                placeholder="è¯·è¾“å…¥å¯†ç "
                                class="form-input"
                                required
                                minlength="6"
                            />
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmPassword">ç¡®è®¤å¯†ç </label>
                            <input
                                id="confirmPassword"
                                v-model="registerForm.confirmPassword"
                                type="password"
                                placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç "
                                class="form-input"
                                required
                            />
                        </div>
                        
                        <div class="form-group">
                            <label for="avatar">é€‰æ‹©å¤´åƒ</label>
                            <div class="avatar-grid">
                                <div
                                    v-for="avatar in avatars"
                                    :key="avatar"
                                    class="avatar-option"
                                    :class="{ active: registerForm.avatar === avatar }"
                                    @click="registerForm.avatar = avatar"
                                >
                                    {{ avatar }}
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary" :disabled="isLoading || !isFormValid">
                            {{ isLoading ? 'æ³¨å†Œä¸­...' : 'æ³¨å†Œ' }}
                        </button>
                        
                        <div class="form-footer">
                            <p>å·²æœ‰è´¦å·ï¼Ÿ<a href="#" @click="$emit('switch-to-login')">ç«‹å³ç™»å½•</a></p>
                        </div>
                    </form>
                </div>
            `
        };

        // æ¸¸æˆè§†å›¾ç»„ä»¶
        const GameView = {
            setup() {
                const gameStore = useGameStore();
                const authStore = useAuthStore();

                // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
                if (!authStore.isLoggedIn) {
                    window.location.href = '/auth';
                    return {};
                }

                return {
                    gameStore
                };
            },
            template: `
                <div class="game-view">
                    <div class="game-layout">
                        <aside class="left-panel">
                            <div class="player-info">
                                <div class="player-header">
                                    <div class="avatar">{{ gameStore.player?.avatar || 'ğŸ‘¤' }}</div>
                                    <div class="player-name">{{ gameStore.player?.name || 'å†’é™©è€…' }}</div>
                                </div>
                                
                                <div class="player-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">ç­‰çº§</span>
                                        <span class="stat-value">Lv.{{ gameStore.player?.level || 1 }}</span>
                                    </div>
                                    
                                    <div class="stat-item">
                                        <span class="stat-label">ğŸ’° é‡‘å¸</span>
                                        <span class="stat-value">{{ gameStore.player?.coins || 0 }}</span>
                                    </div>
                                    
                                    <div class="stat-item">
                                        <span class="stat-label">ğŸ’ å®çŸ³</span>
                                        <span class="stat-value">{{ gameStore.player?.gems || 0 }}</span>
                                    </div>
                                </div>
                            </div>
                        </aside>

                        <main class="game-area">
                            <div class="map-view">
                                <h2>ğŸ® å¯»å®æ¸¸æˆ</h2>
                                <p>æ¬¢è¿æ¥åˆ°å¯»å®ä¸–ç•Œï¼è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºç‰ˆæœ¬ã€‚</p>
                                <p>æ‚¨çš„ç­‰çº§ï¼š{{ gameStore.player?.level || 1 }}</p>
                                <p>æ‚¨çš„é‡‘å¸ï¼š{{ gameStore.player?.coins || 0 }}</p>
                                <p>æ‚¨çš„å®çŸ³ï¼š{{ gameStore.player?.gems || 0 }}</p>
                            </div>
                        </main>

                        <aside class="right-panel">
                            <div class="shop">
                                <div class="shop-header">
                                    <h3>ğŸ›’ ç¥ç§˜å•†åº—</h3>
                                </div>
                                <div class="shop-content">
                                    <div
                                        v-for="item in gameStore.shopItems"
                                        :key="item.id"
                                        class="shop-item"
                                    >
                                        <div class="item-icon">{{ getItemIcon(item.type) }}</div>
                                        <div class="item-info">
                                            <h4 class="item-name">{{ item.name }}</h4>
                                            <p class="item-effect">{{ item.effect }}</p>
                                            <div class="item-footer">
                                                <span class="item-price">ğŸ’° {{ item.price }}</span>
                                                <button
                                                    class="buy-btn"
                                                    @click="handleBuy(item.id)"
                                                    :disabled="(gameStore.player?.coins || 0) < item.price"
                                                >
                                                    è´­ä¹°
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </aside>
                    </div>
                </div>
            `,
            methods: {
                getItemIcon(type) {
                    const icons = {
                        potion: 'ğŸ§ª',
                        boost: 'âš¡',
                        equipment: 'âš”ï¸'
                    };
                    return icons[type] || 'ğŸ“¦';
                },
                handleBuy(itemId) {
                    const success = this.gameStore.buyItem(itemId);
                    if (success) {
                        alert('è´­ä¹°æˆåŠŸï¼ç‰©å“å·²æ·»åŠ åˆ°èƒŒåŒ…ã€‚');
                    } else {
                        alert('é‡‘å¸ä¸è¶³ï¼');
                    }
                }
            }
        };

        // è·¯ç”±é…ç½®
        const routes = [
            {
                path: '/',
                name: 'Game',
                component: GameView,
                meta: { requiresAuth: true }
            },
            {
                path: '/auth',
                name: 'Auth',
                component: Auth
            }
        ];

        const router = createRouter({
            history: createWebHistory(),
            routes
        });

        // è·¯ç”±å®ˆå«
        router.beforeEach((to, from, next) => {
            const authStore = useAuthStore();
            
            if (to.meta && to.meta.requiresAuth) {
                if (!authStore.isLoggedIn) {
                    next('/auth');
                    return;
                }
            }
            
            if (to.name === 'Auth' && authStore.isLoggedIn) {
                next('/');
                return;
            }
            
            next();
        });

        // åˆ›å»ºåº”ç”¨
        const app = createApp(App);
        const pinia = createPinia();

        app.use(pinia);
        app.use(router);

        // æ³¨å†Œç»„ä»¶
        app.component('LoginForm', LoginForm);
        app.component('RegisterForm', RegisterForm);
        app.component('GameView', GameView);
        app.component('Auth', Auth);

        // æŒ‚è½½åº”ç”¨
        app.mount('#app');
    </script>
</body>
</html>
